<h1>Assessment</h1>
<h2>Organisation unit: {{ ou }}</h2>
<h2>Domaine de santé: {{ health_area }}</h2>
<h2>Département: {{ department }}</h2>

@if (sections) { @for(section of this.CurAssmtService.currentAssessment().sections; track
section.id) {
<div class="section">
  <h3>{{ section.title }}</h3>
  <div class="section-score">
    <span class="score-display">Score: {{ section.score }}/{{ section.maxScore }}</span>
    <span class="score-info">({{ section.maxScore }} questions eligible for scoring)</span>
  </div>

  @if (isStandardSection(section)) {
  <p>Type: Standard</p>
  @for(question of getStandardQuestions(section); track question.id) {
  <div class="question">
    <span>Score: {{ question.score }}</span>
    <ul>
      @if(question.level == 0){
      <h4>{{ question.subject }}</h4>

      } @else {
      <li>{{ question.subject }}</li>
      <div class="question-info">
        <span>Score: {{ question.score }}</span>
        @if(question.response) {
        <span class="response-status" [class]="'response-' + question.response.toLowerCase()">
          Response: {{ question.response }}
        </span>
        } @else {
        <span class="no-response">No response yet</span>
        }
      </div>
      <div class="radio-group">
        <mat-radio-group
          [name]="'question_' + section.id + '_' + question.id"
          [value]="getQuestionResponse(section.id, question.id)"
          (change)="
            setQScore({
              isStandardSection: isStandardSection(section),
              sectionId: section.id,
              level: question.level,
              questionId: question.id,
              response: $event.value
            })
          "
        >
          <mat-radio-button value="Oui">Oui</mat-radio-button>
          <mat-radio-button value="Non">Non</mat-radio-button>
          <mat-radio-button value="NA">NA</mat-radio-button>
        </mat-radio-group>
      </div>
      }
    </ul>
  </div>
  } } @else if (isDQSection(section)) {
  <p>Type: Data Quality</p>
  @for(question of getDQQuestions(section); track question.id) {
  <div class="question dq-question">
    <h4>Data Quality Assessment</h4>
    @for(subsection of question.subsections; track subsection.id) {
    <div class="subsection">
      <h5>{{ subsection.instruction }}</h5>
      @for(evaluation of subsection.questions; track evaluation.evaluationTopic) {
      <div class="evaluation">
        <h6>{{ evaluation.evaluationTopic }}</h6>
        @for(entry of evaluation.monthlyEntries; track entry.id) {
        <div class="monthly-entry">
          <div class="entry-header">
            <strong>{{ entry.month }}</strong> - Answer: {{ entry.answer }}
          </div>
          @if (entry.elements && entry.elements.length > 0) {
          <div class="data-elements">
            <h6>Data Elements:</h6>
            @for(element of entry.elements; track element.id) {
            <div class="element">{{ element.name }}: {{ element.data }}</div>
            }
          </div>
          } @if (entry.evals && entry.evals.length > 0) {
          <div class="evaluations">
            <h6>Evaluations:</h6>
            @for(eval of entry.evals; track eval.id) {
            <div class="eval">{{ eval.name }}: {{ eval.score }}</div>
            }
          </div>
          }
        </div>
        }
      </div>
      }
    </div>
    }
  </div>
  } }
</div>
} } @else {
<p>Loading assessment...</p>
}
